name: Build and Deploy
on: [push]
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2

    - name: Setup Node.js
      uses: actions/setup-node@v1
      with:
        # choose node.js version to use
        node-version: '14'

    # cache node_modules
    - name: Cache dependencies
      uses: actions/cache@v2
      id: yarn-cache
      with:
        path: |
          **/node_modules
        key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
        restore-keys: |
          ${{ runner.os }}-yarn-

    # install dependencies if the cache did not hit
    - name: Install dependencies
      if: steps.yarn-cache.outputs.cache-hit != 'true'
      run: yarn --frozen-lockfile

    # run build script
    - name: Build VuePress site
      run: yarn docs:build

    - name: ipfs-action
      uses: aquiladev/ipfs-action@v0.1.1
      id: upload
      with:
        path: docs/.vuepress/dist/
